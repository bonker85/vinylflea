$(document).ready((function(){document.addEventListener("click",(function(e){const a=document.querySelector(".block-icons");if(e.target===a||a.contains(e.target))return;"block"==$(".block-icons .profile-menu").css("display")&&$(".block-icons .profile-menu").css("display","none")})),$(".dropdown-menu a.dropdown-toggle").on("click",(function(e){return $(this).next().hasClass("show")||$(this).parents(".dropdown-menu").first().find(".show").removeClass("show"),$(this).next(".dropdown-menu").toggleClass("show"),$(this).parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",(function(e){$(".submenu .show").removeClass("show")})),!1})),$(window).on("scroll",(function(){$(this).scrollTop()>300?$(".back-to-top").fadeIn():$(".back-to-top").fadeOut()})),$(".back-to-top").on("click",(function(){return $("html, body").animate({scrollTop:0},600),!1})),$("[data-trigger]").on("click",(function(e){e.preventDefault(),e.stopPropagation();var a=$(this).attr("data-trigger");$(a).toggleClass("show"),$("body").toggleClass("offcanvas-active"),$(".screen-overlay").toggleClass("show")})),$(document).on("keydown",(function(e){27===e.keyCode&&($(".mobile-offcanvas").removeClass("show"),$("body").removeClass("overlay-active"))})),$(".btn-close, .screen-overlay").click((function(e){$(".screen-overlay").removeClass("show"),$(".mobile-offcanvas").removeClass("show"),$("body").removeClass("offcanvas-active")})),$(".latest-news").length&&$(".latest-news").owlCarousel({loop:!0,margin:10,responsiveClass:!0,nav:!1,dots:!1,responsive:{0:{items:1},600:{items:2},1024:{items:3},1366:{items:4}}}),$(".logout_link").on("click",(function(){$("#logout_form").submit()})),$("#show_hide_password a").on("click",(function(e){e.preventDefault(),"text"==$("#show_hide_password input").attr("type")?($("#show_hide_password input").attr("type","password"),$("#show_hide_password i").addClass("bx-hide"),$("#show_hide_password i").removeClass("bx-show")):"password"==$("#show_hide_password input").attr("type")&&($("#show_hide_password input").attr("type","text"),$("#show_hide_password i").removeClass("bx-hide"),$("#show_hide_password i").addClass("bx-show"))})),$(".avatar-img").on("click",(function(){$(".block-icons .profile-menu").toggle()})),$(".del-vinyl-img").on("click",(function(e){const a=$(this).attr("id").replace("del-vinyl-img",""),s=$("#"+$(this).attr("id").replace("del-vinyl-img","img-vinyl-")).attr("src"),t=s.substr(s.lastIndexOf(".")+1);let o="",r="";-1===t.indexOf("?")?(o=t,r=$("#del-vinyl-img"+a).attr("data-image")):o=t.substr(0,t.indexOf("?"));const n=$("#img-vinyl-"+a);$.ajax({type:"GET",url:"/ajax/vinyl_delete?id="+a+"&ext="+o+"&image="+r,success:function(e){""==e.error?(n.removeClass("vinyl-img"),n.addClass("no-vinyl-img"),$("#vinyl"+a).val(""),n.attr("src",e.url),$("#del-vinyl-img"+a).hide(),$(".error_message").hide(),$(".error_message").text("")):($(".error_message").text(e.error),$(".error_message").show())}})})),$("#js-file-vinyl").change((function(){if(void 0===window.FormData)alert("В вашем браузере FormData не поддерживается");else for(let a=0;a<4;a++){let s=$(".vinyl-img-block .vinyl-set")[a],t=$("img",s);if(t.hasClass("no-vinyl-img")){t.removeClass("no-vinyl-img"),t.addClass("vinyl-img"),t.addClass("d-none"),$(".spinner-border",s).removeClass("d-none"),$(".add-advert-button").attr("disabled",!0);var e=new FormData;let o=a+1;return e.append("vinyl"+o,$("#js-file-vinyl")[0].files[0]),e.append("id",o),$.ajax({type:"POST",url:"/ajax/vinyl_file",cache:!1,contentType:!1,processData:!1,data:e,dataType:"json",success:function(e){""==e.error?($(".error_message").hide(),$(".error_message").text(""),$("#del-vinyl-img"+o).addClass("bx-x").show(),$("#vinyl"+o).val(e.url),t.attr("src",e.url)):($("#vinyl"+o).val(""),t.removeClass("vinyl-img"),t.addClass("no-vinyl-img"),$(".error_message").text(e.error),$(".error_message").show()),t.removeClass("d-none"),$(".spinner-border",s).addClass("d-none"),$(".add-advert-button").attr("disabled",!1)}}),$("#js-file-vinyl").val(""),!0}}$("#js-file-vinyl").val("")})),$("#js-file-avatar").change((function(){if(void 0===window.FormData)alert("В вашем браузере FormData не поддерживается");else{$("#img-avatar").addClass("d-none"),$(".spinner-border").removeClass("d-none");var e=new FormData;e.append("avatar",$("#js-file-avatar")[0].files[0]),$.ajax({type:"POST",url:"/ajax/avatar_file",cache:!1,contentType:!1,processData:!1,data:e,dataType:"json",success:function(e){""==e.error?($(".error_message").hide(),$(".error_message").text(""),$("#img-avatar").attr("src",e.url)):($(".error_message").text(e.error),$(".error_message").show()),$("#img-avatar").removeClass("d-none"),$(".spinner-border").addClass("d-none")}})}})),$(".profile-info-formblock #phone").on("blur",(function(){"+375 (__) ___-__-__"==$(this).val()&&$(this).val("")})),$(".profile-add_advert-formblock select[name=status]").on("change",(function(e){3==$(this).val()?$("#reject_message_block").show():$("#reject_message_block").hide()})),$(".profile-add_advert-formblock #deal").on("change",(function(e){"sale"==$(this).val()?(0==$("#price").val()&&$("#price").val(""),$(".deal-sale").show()):($(".deal-sale").hide(),$("#price").val()||$("#price").val(0))})),$(".button-phone").on("click",(function(){const e=$(this).data("advert"),a=$(this).data("user"),s={params:""};if(e)s.params="advert="+e;else{if(!a)return!1;s.params="user_id="+a}$.ajax({type:"GET",url:"/ajax/show_phone?"+s.params,success:function(e){e.mess&&$(".button-phone").text(e.mess).css("cursor","unset").off()}})})),$("#message-modal").on("show.bs.modal",(function(e){$(".modal-body p.alert-danger").hide();let a=$(e.relatedTarget);$("#messageModalLabel").text($(a).attr("data-name")),$("#advert_id").val($(a).attr("data-id"))})),$(".modal-message-button").on("click",(function(){if(!$("#message-modal #message").val())return $(".modal-body p.alert-danger").text("Поле сообщения не заполено.").show(),!1;$.ajax({url:"/ajax/front-message",method:"POST",data:{message:$("#message").val(),id:$("#advert_id").val(),_token:$(".modal input[name=_token]").val()}}).done((function(e){e.error?$(".modal-body p.alert-danger").text("Произошла ошибка. Сообщение не отправлено.").show():($("#message-modal").modal("hide"),location.href="/profile/messages/"+e.dialog_id)}))})),$(".advert-show-list").on("click",(function(){"block"==$(".advert-mess-list").css("display")?($(".advert-mess-list").hide(),$(".advert-mess-h",this).text("Показать все сообщения"),$(this).css("border-bottom","")):($(this).css("border-bottom","1px solid #DEE2E6"),$(".advert-mess-h",this).text("Скрыть все сообщения"),$(".advert-mess-list").show())})),document.querySelector(".messages-block")&&(document.querySelector(".messages-block").scrollTop=1e5),$("#message_form").on("submit",(function(e){if(e.preventDefault(),!$(".message-textarea").val())return $(".message-textarea").css("border","1px solid #d22f2f"),!1;$(".message-textarea").css("border","unset"),$.ajax({url:$("#message_form").attr("action"),method:"POST",data:{message:$(".message-textarea").val(),id:$("#advert_id").val(),_token:$("input[name=_token]",$(this)).val()}}).done((function(e){e.error||e.chat&&($(".chat").html(e.chat),$(".message-textarea").val(""),document.querySelector(".messages-block").scrollTop=1e5)}))})),$(".ad-search").search({apiSettings:{url:"/ajax/ad_search?q={query}"},error:{noResults:"Ваш запрос не дал результатов"},fields:{results:"items",title:"name",url:"url"},minCharacters:3,maxResults:20}),$(".search-edition").search({apiSettings:{url:"/ajax/search_edition?q={query}"},error:{noResults:"Ваш запрос не дал результатов"},fields:{results:"items",title:"name"},minCharacters:1,maxResults:20}),$(".u-search").search({apiSettings:{url:"/ajax/search?q={query}&user_id="+$("#s-user").val()+"&style="+$(".search-style :selected",$(".u-search")).attr("data-id")+"&profile="+($("#s-status").val()?$("#s-status").val():"")},error:{noResults:"Ваш запрос не дал результатов"},fields:{results:"items",title:"name",url:"url"},minCharacters:3,maxResults:20}),$(".search").on("keydown",(function(a){13===a.keyCode&&e($('input[type="text"]',$(this)),$("select",$(this)))})),$(".all-search select").on("change",(function(){e($(".all-search input"),$(this))})),$(".u-search select").on("change",(function(){e($('.u-search input[type="text"]'),$(this))}));const e=function(e,a){let s=e.parent().parent().parent(),t="";e.val()&&(t=s.find("#s-user").length?"?uq="+e.val():"?q="+e.val()),location.href=void 0===a?"/profile/"+$("#s-status").val()+t:a.val()+t};$(".all-search.search").search({apiSettings:{url:"/ajax/search?q={query}&style="+$(":selected",this).attr("data-id")},error:{noResults:"Ваш запрос не дал результатов"},fields:{results:"items",title:"name",url:"url"},minCharacters:3,maxResults:20}),$(".favorit-link").on("click",(function(e){const a=$(this).attr("data-advert");$.ajax({url:"/ajax/favorit",method:"GET",data:{user_id:$(this).attr("data-user"),advert_id:a}}).done((function(e){e.res?$('.favorit-link[data-advert="'+a+'"] i').removeClass("bx-heart").addClass("bxs-heart"):$('.favorit-link[data-advert="'+a+'"] i').removeClass("bxs-heart").addClass("bx-heart")}))})),$("#ad-rejected").hasClass("active")&&$(".adverts-block .table-responsive").scrollLeft($("#ad-mod").offset().left),$("#ad-deact").hasClass("active")&&$(".adverts-block .table-responsive").scrollLeft($("#ad-rejected").offset().left)})),function(){"use strict";window.addEventListener("load",(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,(function(e){e.addEventListener("submit",(function(a){let s=!1;!1===e.checkValidity()&&(a.preventDefault(),a.stopPropagation(),s=!0),e.classList.add("was-validated"),s&&$("html, body").animate({scrollTop:$($(":invalid")[1]).offset().top-20},500)}),!1)}))}),!1)}();
