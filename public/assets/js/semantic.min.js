;(function($,window,document,undefined){'use strict';window=(typeof window!='undefined'&&window.Math==Math)?window:(typeof self!='undefined'&&self.Math==Math)?self:Function('return this')();$.fn.checkbox=function(parameters){var
    $allModules=$(this),moduleSelector=$allModules.selector||'',time=new Date().getTime(),performance=[],query=arguments[0],methodInvoked=(typeof query=='string'),queryArguments=[].slice.call(arguments,1),returnedValue;$allModules.each(function(){var
    settings=$.extend(true,{},$.fn.checkbox.settings,parameters),className=settings.className,namespace=settings.namespace,selector=settings.selector,error=settings.error,eventNamespace='.'+namespace,moduleNamespace='module-'+namespace,$module=$(this),$label=$(this).children(selector.label),$input=$(this).children(selector.input),input=$input[0],initialLoad=false,shortcutPressed=false,instance=$module.data(moduleNamespace),observer,element=this,module;module={initialize:function(){module.verbose('Initializing checkbox',settings);module.create.label();module.bind.events();module.set.tabbable();module.hide.input();module.observeChanges();module.instantiate();module.setup();},instantiate:function(){module.verbose('Storing instance of module',module);instance=module;$module.data(moduleNamespace,module);},destroy:function(){module.verbose('Destroying module');module.unbind.events();module.show.input();$module.removeData(moduleNamespace);},fix:{reference:function(){if($module.is(selector.input)){module.debug('Behavior called on <input> adjusting invoked element');$module=$module.closest(selector.checkbox);module.refresh();}}},setup:function(){module.set.initialLoad();if(module.is.indeterminate()){module.debug('Initial value is indeterminate');module.indeterminate();}
    else if(module.is.checked()){module.debug('Initial value is checked');module.check();}
    else{module.debug('Initial value is unchecked');module.uncheck();}
        module.remove.initialLoad();},refresh:function(){$label=$module.children(selector.label);$input=$module.children(selector.input);input=$input[0];},hide:{input:function(){module.verbose('Modifying <input> z-index to be unselectable');$input.addClass(className.hidden);}},show:{input:function(){module.verbose('Modifying <input> z-index to be selectable');$input.removeClass(className.hidden);}},observeChanges:function(){if('MutationObserver'in window){observer=new MutationObserver(function(mutations){module.debug('DOM tree modified, updating selector cache');module.refresh();});observer.observe(element,{childList:true,subtree:true});module.debug('Setting up mutation observer',observer);}},attachEvents:function(selector,event){var
        $element=$(selector);event=$.isFunction(module[event])?module[event]:module.toggle;if($element.length>0){module.debug('Attaching checkbox events to element',selector,event);$element.on('click'+eventNamespace,event);}
    else{module.error(error.notFound);}},event:{click:function(event){var
            $target=$(event.target);if($target.is(selector.input)){module.verbose('Using default check action on initialized checkbox');return;}
            if($target.is(selector.link)){module.debug('Clicking link inside checkbox, skipping toggle');return;}
            module.toggle();$input.focus();event.preventDefault();},keydown:function(event){var
            key=event.which,keyCode={enter:13,space:32,escape:27};if(key==keyCode.escape){module.verbose('Escape key pressed blurring field');$input.blur();shortcutPressed=true;}
        else if(!event.ctrlKey&&(key==keyCode.space||key==keyCode.enter)){module.verbose('Enter/space key pressed, toggling checkbox');module.toggle();shortcutPressed=true;}
        else{shortcutPressed=false;}},keyup:function(event){if(shortcutPressed){event.preventDefault();}}},check:function(){if(!module.should.allowCheck()){return;}
        module.debug('Checking checkbox',$input);module.set.checked();if(!module.should.ignoreCallbacks()){settings.onChecked.call(input);settings.onChange.call(input);}},uncheck:function(){if(!module.should.allowUncheck()){return;}
        module.debug('Unchecking checkbox');module.set.unchecked();if(!module.should.ignoreCallbacks()){settings.onUnchecked.call(input);settings.onChange.call(input);}},indeterminate:function(){if(module.should.allowIndeterminate()){module.debug('Checkbox is already indeterminate');return;}
        module.debug('Making checkbox indeterminate');module.set.indeterminate();if(!module.should.ignoreCallbacks()){settings.onIndeterminate.call(input);settings.onChange.call(input);}},determinate:function(){if(module.should.allowDeterminate()){module.debug('Checkbox is already determinate');return;}
        module.debug('Making checkbox determinate');module.set.determinate();if(!module.should.ignoreCallbacks()){settings.onDeterminate.call(input);settings.onChange.call(input);}},enable:function(){if(module.is.enabled()){module.debug('Checkbox is already enabled');return;}
        module.debug('Enabling checkbox');module.set.enabled();settings.onEnable.call(input);settings.onEnabled.call(input);},disable:function(){if(module.is.disabled()){module.debug('Checkbox is already disabled');return;}
        module.debug('Disabling checkbox');module.set.disabled();settings.onDisable.call(input);settings.onDisabled.call(input);},get:{radios:function(){var
            name=module.get.name();return $('input[name="'+name+'"]').closest(selector.checkbox);},otherRadios:function(){return module.get.radios().not($module);},name:function(){return $input.attr('name');}},is:{initialLoad:function(){return initialLoad;},radio:function(){return($input.hasClass(className.radio)||$input.attr('type')=='radio');},indeterminate:function(){return $input.prop('indeterminate')!==undefined&&$input.prop('indeterminate');},checked:function(){return $input.prop('checked')!==undefined&&$input.prop('checked');},disabled:function(){return $input.prop('disabled')!==undefined&&$input.prop('disabled');},enabled:function(){return!module.is.disabled();},determinate:function(){return!module.is.indeterminate();},unchecked:function(){return!module.is.checked();}},should:{allowCheck:function(){if(module.is.determinate()&&module.is.checked()&&!module.should.forceCallbacks()){module.debug('Should not allow check, checkbox is already checked');return false;}
            if(settings.beforeChecked.apply(input)===false){module.debug('Should not allow check, beforeChecked cancelled');return false;}
            return true;},allowUncheck:function(){if(module.is.determinate()&&module.is.unchecked()&&!module.should.forceCallbacks()){module.debug('Should not allow uncheck, checkbox is already unchecked');return false;}
            if(settings.beforeUnchecked.apply(input)===false){module.debug('Should not allow uncheck, beforeUnchecked cancelled');return false;}
            return true;},allowIndeterminate:function(){if(module.is.indeterminate()&&!module.should.forceCallbacks()){module.debug('Should not allow indeterminate, checkbox is already indeterminate');return false;}
            if(settings.beforeIndeterminate.apply(input)===false){module.debug('Should not allow indeterminate, beforeIndeterminate cancelled');return false;}
            return true;},allowDeterminate:function(){if(module.is.determinate()&&!module.should.forceCallbacks()){module.debug('Should not allow determinate, checkbox is already determinate');return false;}
            if(settings.beforeDeterminate.apply(input)===false){module.debug('Should not allow determinate, beforeDeterminate cancelled');return false;}
            return true;},forceCallbacks:function(){return(module.is.initialLoad()&&settings.fireOnInit);},ignoreCallbacks:function(){return(initialLoad&&!settings.fireOnInit);}},can:{change:function(){return!($module.hasClass(className.disabled)||$module.hasClass(className.readOnly)||$input.prop('disabled')||$input.prop('readonly'));},uncheck:function(){return(typeof settings.uncheckable==='boolean')?settings.uncheckable:!module.is.radio();}},set:{initialLoad:function(){initialLoad=true;},checked:function(){module.verbose('Setting class to checked');$module.removeClass(className.indeterminate).addClass(className.checked);if(module.is.radio()){module.uncheckOthers();}
            if(!module.is.indeterminate()&&module.is.checked()){module.debug('Input is already checked, skipping input property change');return;}
            module.verbose('Setting state to checked',input);$input.prop('indeterminate',false).prop('checked',true);module.trigger.change();},unchecked:function(){module.verbose('Removing checked class');$module.removeClass(className.indeterminate).removeClass(className.checked);if(!module.is.indeterminate()&&module.is.unchecked()){module.debug('Input is already unchecked');return;}
            module.debug('Setting state to unchecked');$input.prop('indeterminate',false).prop('checked',false);module.trigger.change();},indeterminate:function(){module.verbose('Setting class to indeterminate');$module.addClass(className.indeterminate);if(module.is.indeterminate()){module.debug('Input is already indeterminate, skipping input property change');return;}
            module.debug('Setting state to indeterminate');$input.prop('indeterminate',true);module.trigger.change();},determinate:function(){module.verbose('Removing indeterminate class');$module.removeClass(className.indeterminate);if(module.is.determinate()){module.debug('Input is already determinate, skipping input property change');return;}
            module.debug('Setting state to determinate');$input.prop('indeterminate',false);},disabled:function(){module.verbose('Setting class to disabled');$module.addClass(className.disabled);if(module.is.disabled()){module.debug('Input is already disabled, skipping input property change');return;}
            module.debug('Setting state to disabled');$input.prop('disabled','disabled');module.trigger.change();},enabled:function(){module.verbose('Removing disabled class');$module.removeClass(className.disabled);if(module.is.enabled()){module.debug('Input is already enabled, skipping input property change');return;}
            module.debug('Setting state to enabled');$input.prop('disabled',false);module.trigger.change();},tabbable:function(){module.verbose('Adding tabindex to checkbox');if($input.attr('tabindex')===undefined){$input.attr('tabindex',0);}}},remove:{initialLoad:function(){initialLoad=false;}},trigger:{change:function(){var
            events=document.createEvent('HTMLEvents'),inputElement=$input[0];if(inputElement){module.verbose('Triggering native change event');events.initEvent('change',true,false);inputElement.dispatchEvent(events);}}},create:{label:function(){if($input.prevAll(selector.label).length>0){$input.prev(selector.label).detach().insertAfter($input);module.debug('Moving existing label',$label);}
        else if(!module.has.label()){$label=$('<label>').insertAfter($input);module.debug('Creating label',$label);}}},has:{label:function(){return($label.length>0);}},bind:{events:function(){module.verbose('Attaching checkbox events');$module.on('click'+eventNamespace,module.event.click).on('keydown'+eventNamespace,selector.input,module.event.keydown).on('keyup'+eventNamespace,selector.input,module.event.keyup);}},unbind:{events:function(){module.debug('Removing events');$module.off(eventNamespace);}},uncheckOthers:function(){var
        $radios=module.get.otherRadios();module.debug('Unchecking other radios',$radios);$radios.removeClass(className.checked);},toggle:function(){if(!module.can.change()){if(!module.is.radio()){module.debug('Checkbox is read-only or disabled, ignoring toggle');}
        return;}
        if(module.is.indeterminate()||module.is.unchecked()){module.debug('Currently unchecked');module.check();}
        else if(module.is.checked()&&module.can.uncheck()){module.debug('Currently checked');module.uncheck();}},setting:function(name,value){module.debug('Changing setting',name,value);if($.isPlainObject(name)){$.extend(true,settings,name);}
    else if(value!==undefined){if($.isPlainObject(settings[name])){$.extend(true,settings[name],value);}
    else{settings[name]=value;}}
    else{return settings[name];}},internal:function(name,value){if($.isPlainObject(name)){$.extend(true,module,name);}
    else if(value!==undefined){module[name]=value;}
    else{return module[name];}},debug:function(){if(!settings.silent&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.debug=Function.prototype.bind.call(console.info,console,settings.name+':');module.debug.apply(console,arguments);}}},verbose:function(){if(!settings.silent&&settings.verbose&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.verbose=Function.prototype.bind.call(console.info,console,settings.name+':');module.verbose.apply(console,arguments);}}},error:function(){if(!settings.silent){module.error=Function.prototype.bind.call(console.error,console,settings.name+':');module.error.apply(console,arguments);}},performance:{log:function(message){var
            currentTime,executionTime,previousTime;if(settings.performance){currentTime=new Date().getTime();previousTime=time||currentTime;executionTime=currentTime-previousTime;time=currentTime;performance.push({'Name':message[0],'Arguments':[].slice.call(message,1)||'','Element':element,'Execution Time':executionTime});}
            clearTimeout(module.performance.timer);module.performance.timer=setTimeout(module.performance.display,500);},display:function(){var
            title=settings.name+':',totalTime=0;time=false;clearTimeout(module.performance.timer);$.each(performance,function(index,data){totalTime+=data['Execution Time'];});title+=' '+totalTime+'ms';if(moduleSelector){title+=' \''+moduleSelector+'\'';}
            if((console.group!==undefined||console.table!==undefined)&&performance.length>0){console.groupCollapsed(title);if(console.table){console.table(performance);}
            else{$.each(performance,function(index,data){console.log(data['Name']+': '+data['Execution Time']+'ms');});}
                console.groupEnd();}
            performance=[];}},invoke:function(query,passedArguments,context){var
        object=instance,maxDepth,found,response;passedArguments=passedArguments||queryArguments;context=element||context;if(typeof query=='string'&&object!==undefined){query=query.split(/[\. ]/);maxDepth=query.length-1;$.each(query,function(depth,value){var camelCaseValue=(depth!=maxDepth)?value+query[depth+1].charAt(0).toUpperCase()+query[depth+1].slice(1):query;if($.isPlainObject(object[camelCaseValue])&&(depth!=maxDepth)){object=object[camelCaseValue];}
    else if(object[camelCaseValue]!==undefined){found=object[camelCaseValue];return false;}
    else if($.isPlainObject(object[value])&&(depth!=maxDepth)){object=object[value];}
    else if(object[value]!==undefined){found=object[value];return false;}
    else{module.error(error.method,query);return false;}});}
        if($.isFunction(found)){response=found.apply(context,passedArguments);}
        else if(found!==undefined){response=found;}
        if($.isArray(returnedValue)){returnedValue.push(response);}
        else if(returnedValue!==undefined){returnedValue=[returnedValue,response];}
        else if(response!==undefined){returnedValue=response;}
        return found;}};if(methodInvoked){if(instance===undefined){module.initialize();}
    module.invoke(query);}
else{if(instance!==undefined){instance.invoke('destroy');}
    module.initialize();}});return(returnedValue!==undefined)?returnedValue:this;};$.fn.checkbox.settings={name:'Checkbox',namespace:'checkbox',silent:false,debug:false,verbose:true,performance:true,uncheckable:'auto',fireOnInit:false,onChange:function(){},beforeChecked:function(){},beforeUnchecked:function(){},beforeDeterminate:function(){},beforeIndeterminate:function(){},onChecked:function(){},onUnchecked:function(){},onDeterminate:function(){},onIndeterminate:function(){},onEnable:function(){},onDisable:function(){},onEnabled:function(){},onDisabled:function(){},className:{checked:'checked',indeterminate:'indeterminate',disabled:'disabled',hidden:'hidden',radio:'radio',readOnly:'read-only'},error:{method:'The method you called is not defined'},selector:{checkbox:'.ui.checkbox',label:'label, .box',input:'input[type="checkbox"], input[type="radio"]',link:'a[href]'}};})(jQuery,window,document);;(function($,window,document,undefined){'use strict';window=(typeof window!='undefined'&&window.Math==Math)?window:(typeof self!='undefined'&&self.Math==Math)?self:Function('return this')();$.fn.search=function(parameters){var
    $allModules=$(this),moduleSelector=$allModules.selector||'',time=new Date().getTime(),performance=[],query=arguments[0],methodInvoked=(typeof query=='string'),queryArguments=[].slice.call(arguments,1),returnedValue;$(this).each(function(){var
    settings=($.isPlainObject(parameters))?$.extend(true,{},$.fn.search.settings,parameters):$.extend({},$.fn.search.settings),className=settings.className,metadata=settings.metadata,regExp=settings.regExp,fields=settings.fields,selector=settings.selector,error=settings.error,namespace=settings.namespace,eventNamespace='.'+namespace,moduleNamespace=namespace+'-module',$module=$(this),$prompt=$module.find(selector.prompt),$searchButton=$module.find(selector.searchButton),$results=$module.find(selector.results),$result=$module.find(selector.result),$category=$module.find(selector.category),element=this,instance=$module.data(moduleNamespace),disabledBubbled=false,resultsDismissed=false,module;module={initialize:function(){module.verbose('Initializing module');module.get.settings();module.determine.searchFields();module.bind.events();module.set.type();module.create.results();module.instantiate();},instantiate:function(){module.verbose('Storing instance of module',module);instance=module;$module.data(moduleNamespace,module);},destroy:function(){module.verbose('Destroying instance');$module.off(eventNamespace).removeData(moduleNamespace);},refresh:function(){module.debug('Refreshing selector cache');$prompt=$module.find(selector.prompt);$searchButton=$module.find(selector.searchButton);$category=$module.find(selector.category);$results=$module.find(selector.results);$result=$module.find(selector.result);},refreshResults:function(){$results=$module.find(selector.results);$result=$module.find(selector.result);},bind:{events:function(){module.verbose('Binding events to search');if(settings.automatic){$module.on(module.get.inputEvent()+eventNamespace,selector.prompt,module.event.input);$prompt.attr('autocomplete','off');}
            $module.on('focus'+eventNamespace,selector.prompt,module.event.focus).on('blur'+eventNamespace,selector.prompt,module.event.blur).on('keydown'+eventNamespace,selector.prompt,module.handleKeyboard).on('click'+eventNamespace,selector.searchButton,module.query).on('mousedown'+eventNamespace,selector.results,module.event.result.mousedown).on('mouseup'+eventNamespace,selector.results,module.event.result.mouseup).on('click'+eventNamespace,selector.result,module.event.result.click);}},determine:{searchFields:function(){if(parameters&&parameters.searchFields!==undefined){settings.searchFields=parameters.searchFields;}}},event:{input:function(){if(settings.searchDelay){clearTimeout(module.timer);module.timer=setTimeout(function(){if(module.is.focused()){module.query();}},settings.searchDelay);}
        else{module.query();}},focus:function(){module.set.focus();if(settings.searchOnFocus&&module.has.minimumCharacters()){module.query(function(){if(module.can.show()){module.showResults();}});}},blur:function(event){var
            pageLostFocus=(document.activeElement===this),callback=function(){module.cancel.query();module.remove.focus();module.timer=setTimeout(module.hideResults,settings.hideDelay);};if(pageLostFocus){return;}
            resultsDismissed=false;if(module.resultsClicked){module.debug('Determining if user action caused search to close');$module.one('click.close'+eventNamespace,selector.results,function(event){if(module.is.inMessage(event)||disabledBubbled){$prompt.focus();return;}
                disabledBubbled=false;if(!module.is.animating()&&!module.is.hidden()){callback();}});}
            else{module.debug('Input blurred without user action, closing results');callback();}},result:{mousedown:function(){module.resultsClicked=true;},mouseup:function(){module.resultsClicked=false;},click:function(event){module.debug('Search result selected');var
                $result=$(this),$title=$result.find(selector.title).eq(0),$link=$result.is('a[href]')?$result:$result.find('a[href]').eq(0),href=$link.attr('href')||false,target=$link.attr('target')||false,title=$title.html(),value=($title.length>0)?$title.text():false,results=module.get.results(),result=$result.data(metadata.result)||module.get.result(value,results),returnedValue;if($.isFunction(settings.onSelect)){if(settings.onSelect.call(element,result,results)===false){module.debug('Custom onSelect callback cancelled default select action');disabledBubbled=true;return;}}
                module.hideResults();if(value){module.set.value(value);}
                if(href){module.verbose('Opening search link found in result',$link);if(target=='_blank'||event.ctrlKey){window.open(href);}
                else{window.location.href=(href);}}}}},handleKeyboard:function(event){var
        $result=$module.find(selector.result),$category=$module.find(selector.category),$activeResult=$result.filter('.'+className.active),currentIndex=$result.index($activeResult),resultSize=$result.length,hasActiveResult=$activeResult.length>0,keyCode=event.which,keys={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},newIndex;if(keyCode==keys.escape){module.verbose('Escape key pressed, blurring search field');module.hideResults();resultsDismissed=true;}
        if(module.is.visible()){if(keyCode==keys.enter){module.verbose('Enter key pressed, selecting active result');if($result.filter('.'+className.active).length>0){module.event.result.click.call($result.filter('.'+className.active),event);event.preventDefault();return false;}}
        else if(keyCode==keys.upArrow&&hasActiveResult){module.verbose('Up key pressed, changing active result');newIndex=(currentIndex-1<0)?currentIndex:currentIndex-1;$category.removeClass(className.active);$result.removeClass(className.active).eq(newIndex).addClass(className.active).closest($category).addClass(className.active);event.preventDefault();}
        else if(keyCode==keys.downArrow){module.verbose('Down key pressed, changing active result');newIndex=(currentIndex+1>=resultSize)?currentIndex:currentIndex+1;$category.removeClass(className.active);$result.removeClass(className.active).eq(newIndex).addClass(className.active).closest($category).addClass(className.active);event.preventDefault();}}
        else{if(keyCode==keys.enter){module.verbose('Enter key pressed, executing query');module.query();module.set.buttonPressed();$prompt.one('keyup',module.remove.buttonFocus);}}},setup:{api:function(searchTerm,callback){var
            apiSettings={debug:settings.debug,on:false,cache:settings.cache,action:'search',urlData:{query:searchTerm},onSuccess:function(response){module.parse.response.call(element,response,searchTerm);callback();},onFailure:function(){module.displayMessage(error.serverError);callback();},onAbort:function(response){},onError:module.error},searchHTML;$.extend(true,apiSettings,settings.apiSettings);module.verbose('Setting up API request',apiSettings);$module.api(apiSettings);}},can:{useAPI:function(){return $.fn.api!==undefined;},show:function(){return module.is.focused()&&!module.is.visible()&&!module.is.empty();},transition:function(){return settings.transition&&$.fn.transition!==undefined&&$module.transition('is supported');}},is:{animating:function(){return $results.hasClass(className.animating);},hidden:function(){return $results.hasClass(className.hidden);},inMessage:function(event){if(!event.target){return;}
            var
                $target=$(event.target),isInDOM=$.contains(document.documentElement,event.target);return(isInDOM&&$target.closest(selector.message).length>0);},empty:function(){return($results.html()==='');},visible:function(){return($results.filter(':visible').length>0);},focused:function(){return($prompt.filter(':focus').length>0);}},get:{settings:function(){if($.isPlainObject(parameters)&&parameters.searchFullText){settings.fullTextSearch=parameters.searchFullText;module.error(settings.error.oldSearchSyntax,element);}},inputEvent:function(){var
            prompt=$prompt[0],inputEvent=(prompt!==undefined&&prompt.oninput!==undefined)?'input':(prompt!==undefined&&prompt.onpropertychange!==undefined)?'propertychange':'keyup';return inputEvent;},value:function(){return $prompt.val();},results:function(){var
            results=$module.data(metadata.results);return results;},result:function(value,results){var
            lookupFields=['title','id'],result=false;value=(value!==undefined)?value:module.get.value();results=(results!==undefined)?results:module.get.results();if(settings.type==='category'){module.debug('Finding result that matches',value);$.each(results,function(index,category){if($.isArray(category.results)){result=module.search.object(value,category.results,lookupFields)[0];if(result){return false;}}});}
        else{module.debug('Finding result in results object',value);result=module.search.object(value,results,lookupFields)[0];}
            return result||false;},},select:{firstResult:function(){module.verbose('Selecting first result');$result.first().addClass(className.active);}},set:{focus:function(){$module.addClass(className.focus);},loading:function(){$module.addClass(className.loading);},value:function(value){module.verbose('Setting search input value',value);$prompt.val(value);},type:function(type){type=type||settings.type;if(settings.type=='category'){$module.addClass(settings.type);}},buttonPressed:function(){$searchButton.addClass(className.pressed);}},remove:{loading:function(){$module.removeClass(className.loading);},focus:function(){$module.removeClass(className.focus);},buttonPressed:function(){$searchButton.removeClass(className.pressed);}},query:function(callback){callback=$.isFunction(callback)?callback:function(){};var
        searchTerm=module.get.value(),cache=module.read.cache(searchTerm);callback=callback||function(){};if(module.has.minimumCharacters()){if(cache){module.debug('Reading result from cache',searchTerm);module.save.results(cache.results);module.addResults(cache.html);module.inject.id(cache.results);callback();}
    else{module.debug('Querying for',searchTerm);if($.isPlainObject(settings.source)||$.isArray(settings.source)){module.search.local(searchTerm);callback();}
    else if(module.can.useAPI()){module.search.remote(searchTerm,callback);}
    else{module.error(error.source);callback();}}
        settings.onSearchQuery.call(element,searchTerm);}
    else{module.hideResults();}},search:{local:function(searchTerm){var
            results=module.search.object(searchTerm,settings.content),searchHTML;module.set.loading();module.save.results(results);module.debug('Returned full local search results',results);if(settings.maxResults>0){module.debug('Using specified max results',results);results=results.slice(0,settings.maxResults);}
            if(settings.type=='category'){results=module.create.categoryResults(results);}
            searchHTML=module.generateResults({results:results});module.remove.loading();module.addResults(searchHTML);module.inject.id(results);module.write.cache(searchTerm,{html:searchHTML,results:results});},remote:function(searchTerm,callback){callback=$.isFunction(callback)?callback:function(){};if($module.api('is loading')){$module.api('abort');}
            module.setup.api(searchTerm,callback);$module.api('query');},object:function(searchTerm,source,searchFields){var
            results=[],exactResults=[],fuzzyResults=[],searchExp=searchTerm.toString().replace(regExp.escape,'\\$&'),matchRegExp=new RegExp(regExp.beginsWith+searchExp,'i'),addResult=function(array,result){var
                notResult=($.inArray(result,results)==-1),notFuzzyResult=($.inArray(result,fuzzyResults)==-1),notExactResults=($.inArray(result,exactResults)==-1);if(notResult&&notFuzzyResult&&notExactResults){array.push(result);}};source=source||settings.source;searchFields=(searchFields!==undefined)?searchFields:settings.searchFields;if(!$.isArray(searchFields)){searchFields=[searchFields];}
            if(source===undefined||source===false){module.error(error.source);return[];}
            $.each(searchFields,function(index,field){$.each(source,function(label,content){var
                fieldExists=(typeof content[field]=='string');if(fieldExists){if(content[field].search(matchRegExp)!==-1){addResult(results,content);}
            else if(settings.fullTextSearch==='exact'&&module.exactSearch(searchTerm,content[field])){addResult(exactResults,content);}
            else if(settings.fullTextSearch==true&&module.fuzzySearch(searchTerm,content[field])){addResult(fuzzyResults,content);}}});});$.merge(exactResults,fuzzyResults)
            $.merge(results,exactResults);return results;}},exactSearch:function(query,term){query=query.toLowerCase();term=term.toLowerCase();if(term.indexOf(query)>-1){return true;}
        return false;},fuzzySearch:function(query,term){var
        termLength=term.length,queryLength=query.length;if(typeof query!=='string'){return false;}
        query=query.toLowerCase();term=term.toLowerCase();if(queryLength>termLength){return false;}
        if(queryLength===termLength){return(query===term);}
        search:for(var characterIndex=0,nextCharacterIndex=0;characterIndex<queryLength;characterIndex++){var
            queryCharacter=query.charCodeAt(characterIndex);while(nextCharacterIndex<termLength){if(term.charCodeAt(nextCharacterIndex++)===queryCharacter){continue search;}}
            return false;}
        return true;},parse:{response:function(response,searchTerm){var
            searchHTML=module.generateResults(response);module.verbose('Parsing server response',response);if(response!==undefined){if(searchTerm!==undefined&&response[fields.results]!==undefined){module.addResults(searchHTML);module.inject.id(response[fields.results]);module.write.cache(searchTerm,{html:searchHTML,results:response[fields.results]});module.save.results(response[fields.results]);}}}},cancel:{query:function(){if(module.can.useAPI()){$module.api('abort');}}},has:{minimumCharacters:function(){var
            searchTerm=module.get.value(),numCharacters=searchTerm.length;return(numCharacters>=settings.minCharacters);},results:function(){if($results.length===0){return false;}
            var
                html=$results.html();return html!='';}},clear:{cache:function(value){var
            cache=$module.data(metadata.cache);if(!value){module.debug('Clearing cache',value);$module.removeData(metadata.cache);}
        else if(value&&cache&&cache[value]){module.debug('Removing value from cache',value);delete cache[value];$module.data(metadata.cache,cache);}}},read:{cache:function(name){var
            cache=$module.data(metadata.cache);if(settings.cache){module.verbose('Checking cache for generated html for query',name);return(typeof cache=='object')&&(cache[name]!==undefined)?cache[name]:false;}
            return false;}},create:{categoryResults:function(results){var
            categoryResults={};$.each(results,function(index,result){if(!result.category){return;}
            if(categoryResults[result.category]===undefined){module.verbose('Creating new category of results',result.category);categoryResults[result.category]={name:result.category,results:[result]}}
            else{categoryResults[result.category].results.push(result);}});return categoryResults;},id:function(resultIndex,categoryIndex){var
            resultID=(resultIndex+1),categoryID=(categoryIndex+1),firstCharCode,letterID,id;if(categoryIndex!==undefined){letterID=String.fromCharCode(97+categoryIndex);id=letterID+resultID;module.verbose('Creating category result id',id);}
        else{id=resultID;module.verbose('Creating result id',id);}
            return id;},results:function(){if($results.length===0){$results=$('<div />').addClass(className.results).appendTo($module);}}},inject:{result:function(result,resultIndex,categoryIndex){module.verbose('Injecting result into results');var
            $selectedResult=(categoryIndex!==undefined)?$results.children().eq(categoryIndex).children(selector.results).first().children(selector.result).eq(resultIndex):$results.children(selector.result).eq(resultIndex);module.verbose('Injecting results metadata',$selectedResult);$selectedResult.data(metadata.result,result);},id:function(results){module.debug('Injecting unique ids into results');var
            categoryIndex=0,resultIndex=0;if(settings.type==='category'){$.each(results,function(index,category){resultIndex=0;$.each(category.results,function(index,value){var
            result=category.results[index];if(result.id===undefined){result.id=module.create.id(resultIndex,categoryIndex);}
            module.inject.result(result,resultIndex,categoryIndex);resultIndex++;});categoryIndex++;});}
        else{$.each(results,function(index,value){var
            result=results[index];if(result.id===undefined){result.id=module.create.id(resultIndex);}
            module.inject.result(result,resultIndex);resultIndex++;});}
            return results;}},save:{results:function(results){module.verbose('Saving current search results to metadata',results);$module.data(metadata.results,results);}},write:{cache:function(name,value){var
            cache=($module.data(metadata.cache)!==undefined)?$module.data(metadata.cache):{};if(settings.cache){module.verbose('Writing generated html to cache',name,value);cache[name]=value;$module.data(metadata.cache,cache);}}},addResults:function(html){if($.isFunction(settings.onResultsAdd)){if(settings.onResultsAdd.call($results,html)===false){module.debug('onResultsAdd callback cancelled default action');return false;}}
        if(html){$results.html(html);module.refreshResults();if(settings.selectFirstResult){module.select.firstResult();}
            module.showResults();}
        else{module.hideResults(function(){$results.empty();});}},showResults:function(callback){callback=$.isFunction(callback)?callback:function(){};if(resultsDismissed){return;}
        if(!module.is.visible()&&module.has.results()){if(module.can.transition()){module.debug('Showing results with css animations');$results.transition({animation:settings.transition+' in',debug:settings.debug,verbose:settings.verbose,duration:settings.duration,onComplete:function(){callback();},queue:true});}
        else{module.debug('Showing results with javascript');$results.stop().fadeIn(settings.duration,settings.easing);}
            settings.onResultsOpen.call($results);}},hideResults:function(callback){callback=$.isFunction(callback)?callback:function(){};if(module.is.visible()){if(module.can.transition()){module.debug('Hiding results with css animations');$results.transition({animation:settings.transition+' out',debug:settings.debug,verbose:settings.verbose,duration:settings.duration,onComplete:function(){callback();},queue:true});}
    else{module.debug('Hiding results with javascript');$results.stop().fadeOut(settings.duration,settings.easing);}
        settings.onResultsClose.call($results);}},generateResults:function(response){module.debug('Generating html from response',response);var
        template=settings.templates[settings.type],isProperObject=($.isPlainObject(response[fields.results])&&!$.isEmptyObject(response[fields.results])),isProperArray=($.isArray(response[fields.results])&&response[fields.results].length>0),html='';if(isProperObject||isProperArray){if(settings.maxResults>0){if(isProperObject){if(settings.type=='standard'){module.error(error.maxResults);}}
    else{response[fields.results]=response[fields.results].slice(0,settings.maxResults);}}
        if($.isFunction(template)){html=template(response,fields);}
        else{module.error(error.noTemplate,false);}}
    else if(settings.showNoResults){html=module.displayMessage(error.noResults,'empty');}
        settings.onResults.call(element,response);return html;},displayMessage:function(text,type){type=type||'standard';module.debug('Displaying message',text,type);module.addResults(settings.templates.message(text,type));return settings.templates.message(text,type);},setting:function(name,value){if($.isPlainObject(name)){$.extend(true,settings,name);}
    else if(value!==undefined){settings[name]=value;}
    else{return settings[name];}},internal:function(name,value){if($.isPlainObject(name)){$.extend(true,module,name);}
    else if(value!==undefined){module[name]=value;}
    else{return module[name];}},debug:function(){if(!settings.silent&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.debug=Function.prototype.bind.call(console.info,console,settings.name+':');module.debug.apply(console,arguments);}}},verbose:function(){if(!settings.silent&&settings.verbose&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.verbose=Function.prototype.bind.call(console.info,console,settings.name+':');module.verbose.apply(console,arguments);}}},error:function(){if(!settings.silent){module.error=Function.prototype.bind.call(console.error,console,settings.name+':');module.error.apply(console,arguments);}},performance:{log:function(message){var
            currentTime,executionTime,previousTime;if(settings.performance){currentTime=new Date().getTime();previousTime=time||currentTime;executionTime=currentTime-previousTime;time=currentTime;performance.push({'Name':message[0],'Arguments':[].slice.call(message,1)||'','Element':element,'Execution Time':executionTime});}
            clearTimeout(module.performance.timer);module.performance.timer=setTimeout(module.performance.display,500);},display:function(){var
            title=settings.name+':',totalTime=0;time=false;clearTimeout(module.performance.timer);$.each(performance,function(index,data){totalTime+=data['Execution Time'];});title+=' '+totalTime+'ms';if(moduleSelector){title+=' \''+moduleSelector+'\'';}
            if($allModules.length>1){title+=' '+'('+$allModules.length+')';}
            if((console.group!==undefined||console.table!==undefined)&&performance.length>0){console.groupCollapsed(title);if(console.table){console.table(performance);}
            else{$.each(performance,function(index,data){console.log(data['Name']+': '+data['Execution Time']+'ms');});}
                console.groupEnd();}
            performance=[];}},invoke:function(query,passedArguments,context){var
        object=instance,maxDepth,found,response;passedArguments=passedArguments||queryArguments;context=element||context;if(typeof query=='string'&&object!==undefined){query=query.split(/[\. ]/);maxDepth=query.length-1;$.each(query,function(depth,value){var camelCaseValue=(depth!=maxDepth)?value+query[depth+1].charAt(0).toUpperCase()+query[depth+1].slice(1):query;if($.isPlainObject(object[camelCaseValue])&&(depth!=maxDepth)){object=object[camelCaseValue];}
    else if(object[camelCaseValue]!==undefined){found=object[camelCaseValue];return false;}
    else if($.isPlainObject(object[value])&&(depth!=maxDepth)){object=object[value];}
    else if(object[value]!==undefined){found=object[value];return false;}
    else{return false;}});}
        if($.isFunction(found)){response=found.apply(context,passedArguments);}
        else if(found!==undefined){response=found;}
        if($.isArray(returnedValue)){returnedValue.push(response);}
        else if(returnedValue!==undefined){returnedValue=[returnedValue,response];}
        else if(response!==undefined){returnedValue=response;}
        return found;}};if(methodInvoked){if(instance===undefined){module.initialize();}
    module.invoke(query);}
else{if(instance!==undefined){instance.invoke('destroy');}
    module.initialize();}});return(returnedValue!==undefined)?returnedValue:this;};$.fn.search.settings={name:'Search',namespace:'search',silent:false,debug:false,verbose:false,performance:true,type:'standard',minCharacters:1,selectFirstResult:false,apiSettings:false,source:false,searchOnFocus:true,searchFields:['title','description'],displayField:'',fullTextSearch:'exact',automatic:true,hideDelay:0,searchDelay:200,maxResults:7,cache:true,showNoResults:true,transition:'scale',duration:200,easing:'easeOutExpo',onSelect:false,onResultsAdd:false,onSearchQuery:function(query){},onResults:function(response){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:'animating',active:'active',empty:'empty',focus:'focus',hidden:'hidden',loading:'loading',results:'results',pressed:'down'},error:{source:'Cannot search. No source used, and Semantic API module was not included',noResults:'Your search returned no results',logging:'Error in debug logging, exiting.',noEndpoint:'No search endpoint was specified',noTemplate:'A valid template name was not specified.',oldSearchSyntax:'searchFullText setting has been renamed fullTextSearch for consistency, please adjust your settings.',serverError:'There was an issue querying the server.',maxResults:'Results must be an array to use maxResults setting',method:'The method you called is not defined.'},metadata:{cache:'cache',results:'results',result:'result'},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:'(?:\s|^)'},fields:{categories:'results',categoryName:'name',categoryResults:'results',description:'description',image:'image',price:'price',results:'results',title:'title',url:'url',action:'action',actionText:'text',actionURL:'url'},selector:{prompt:'.prompt',searchButton:'.search.button',results:'.results',message:'.results > .message',category:'.category',result:'.result',title:'.title, .name'},templates:{escape:function(string){var
            badChars=/[&<>"'`]/g,shouldEscape=/[&<>"'`]/,escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},escapedChar=function(chr){return escape[chr];};if(shouldEscape.test(string)){return string.replace(badChars,escapedChar);}
            return string;},message:function(message,type){var
            html='';if(message!==undefined&&type!==undefined){html+=''
            +'<div class="message '+type+'">';if(type=='empty'){html+=''
            +'<div class="header">No Results</div class="header">'
            +'<div class="description">'+message+'</div class="description">';}
        else{html+=' <div class="description">'+message+'</div>';}
            html+='</div>';}
            return html;},category:function(response,fields){var
            html='',escape=$.fn.search.settings.templates.escape;if(response[fields.categoryResults]!==undefined){$.each(response[fields.categoryResults],function(index,category){if(category[fields.results]!==undefined&&category.results.length>0){html+='<div class="category">';if(category[fields.categoryName]!==undefined){html+='<div class="name">'+category[fields.categoryName]+'</div>';}
            html+='<div class="results">';$.each(category.results,function(index,result){if(result[fields.url]){html+='<a class="result" href="'+result[fields.url]+'">';}
            else{html+='<a class="result">';}
                if(result[fields.image]!==undefined){html+=''
                    +'<div class="image">'
                    +' <img src="'+result[fields.image]+'">'
                    +'</div>';}
                html+='<div class="content">';if(result[fields.price]!==undefined){html+='<div class="price">'+result[fields.price]+'</div>';}
                if(result[fields.title]!==undefined){html+='<div class="title">'+result[fields.title]+'</div>';}
                if(result[fields.description]!==undefined){html+='<div class="description">'+result[fields.description]+'</div>';}
                html+=''
                    +'</div>';html+='</a>';});html+='</div>';html+=''
                +'</div>';}});if(response[fields.action]){html+=''
            +'<a href="'+response[fields.action][fields.actionURL]+'" class="action">'
            +response[fields.action][fields.actionText]
            +'</a>';}
            return html;}
            return false;},standard:function(response,fields){var
            html='';if(response[fields.results]!==undefined){$.each(response[fields.results],function(index,result){if(result[fields.url]){html+='<a class="result" href="'+result[fields.url]+'">';}
        else{html+='<a class="result">';}
            if(result[fields.image]!==undefined){html+=''
                +'<div class="image">'
                +' <img src="'+result[fields.image]+'">'
                +'</div>';}
            html+='<div class="content">';if(result[fields.price]!==undefined){html+='<div class="price">'+result[fields.price]+'</div>';}
            if(result[fields.title]!==undefined){html+='<div class="title">'+result[fields.title]+'</div>';}
            if(result[fields.description]!==undefined){html+='<div class="description">'+result[fields.description]+'</div>';}
            html+=''
                +'</div>';html+='</a>';});if(response[fields.action]){html+=''
            +'<a href="'+response[fields.action][fields.actionURL]+'" class="action">'
            +response[fields.action][fields.actionText]
            +'</a>';}
            return html;}
            return false;}}};})(jQuery,window,document);;(function($,window,document,undefined){'use strict';var
    window=(typeof window!='undefined'&&window.Math==Math)?window:(typeof self!='undefined'&&self.Math==Math)?self:Function('return this')();$.api=$.fn.api=function(parameters){var
    $allModules=$.isFunction(this)?$(window):$(this),moduleSelector=$allModules.selector||'',time=new Date().getTime(),performance=[],query=arguments[0],methodInvoked=(typeof query=='string'),queryArguments=[].slice.call(arguments,1),returnedValue;$allModules.each(function(){var
    settings=($.isPlainObject(parameters))?$.extend(true,{},$.fn.api.settings,parameters):$.extend({},$.fn.api.settings),namespace=settings.namespace,metadata=settings.metadata,selector=settings.selector,error=settings.error,className=settings.className,eventNamespace='.'+namespace,moduleNamespace='module-'+namespace,$module=$(this),$form=$module.closest(selector.form),$context=(settings.stateContext)?$(settings.stateContext):$module,ajaxSettings,requestSettings,url,data,requestStartTime,element=this,context=$context[0],instance=$module.data(moduleNamespace),module;module={initialize:function(){if(!methodInvoked){module.bind.events();}
        module.instantiate();},instantiate:function(){module.verbose('Storing instance of module',module);instance=module;$module.data(moduleNamespace,instance);},destroy:function(){module.verbose('Destroying previous module for',element);$module.removeData(moduleNamespace).off(eventNamespace);},bind:{events:function(){var
            triggerEvent=module.get.event();if(triggerEvent){module.verbose('Attaching API events to element',triggerEvent);$module.on(triggerEvent+eventNamespace,module.event.trigger);}
        else if(settings.on=='now'){module.debug('Querying API endpoint immediately');module.query();}}},decode:{json:function(response){if(response!==undefined&&typeof response=='string'){try{response=JSON.parse(response);}
        catch(e){}}
            return response;}},read:{cachedResponse:function(url){var
            response;if(window.Storage===undefined){module.error(error.noStorage);return;}
            response=sessionStorage.getItem(url);module.debug('Using cached response',url,response);response=module.decode.json(response);return response;}},write:{cachedResponse:function(url,response){if(response&&response===''){module.debug('Response empty, not caching',response);return;}
            if(window.Storage===undefined){module.error(error.noStorage);return;}
            if($.isPlainObject(response)){response=JSON.stringify(response);}
            sessionStorage.setItem(url,response);module.verbose('Storing cached response for url',url,response);}},query:function(){if(module.is.disabled()){module.debug('Element is disabled API request aborted');return;}
        if(module.is.loading()){if(settings.interruptRequests){module.debug('Interrupting previous request');module.abort();}
        else{module.debug('Cancelling request, previous request is still pending');return;}}
        if(settings.defaultData){$.extend(true,settings.urlData,module.get.defaultData());}
        if(settings.serializeForm){settings.data=module.add.formData(settings.data);}
        requestSettings=module.get.settings();if(requestSettings===false){module.cancelled=true;module.error(error.beforeSend);return;}
        else{module.cancelled=false;}
        url=module.get.templatedURL();if(!url&&!module.is.mocked()){module.error(error.missingURL);return;}
        url=module.add.urlData(url);if(!url&&!module.is.mocked()){return;}
        requestSettings.url=settings.base+url;ajaxSettings=$.extend(true,{},settings,{type:settings.method||settings.type,data:data,url:settings.base+url,beforeSend:settings.beforeXHR,success:function(){},failure:function(){},complete:function(){}});module.debug('Querying URL',ajaxSettings.url);module.verbose('Using AJAX settings',ajaxSettings);if(settings.cache==='local'&&module.read.cachedResponse(url)){module.debug('Response returned from local cache');module.request=module.create.request();module.request.resolveWith(context,[module.read.cachedResponse(url)]);return;}
        if(!settings.throttle){module.debug('Sending request',data,ajaxSettings.method);module.send.request();}
        else{if(!settings.throttleFirstRequest&&!module.timer){module.debug('Sending request',data,ajaxSettings.method);module.send.request();module.timer=setTimeout(function(){},settings.throttle);}
        else{module.debug('Throttling request',settings.throttle);clearTimeout(module.timer);module.timer=setTimeout(function(){if(module.timer){delete module.timer;}
            module.debug('Sending throttled request',data,ajaxSettings.method);module.send.request();},settings.throttle);}}},should:{removeError:function(){return(settings.hideError===true||(settings.hideError==='auto'&&!module.is.form()));}},is:{disabled:function(){return($module.filter(selector.disabled).length>0);},expectingJSON:function(){return settings.dataType==='json'||settings.dataType==='jsonp';},form:function(){return $module.is('form')||$context.is('form');},mocked:function(){return(settings.mockResponse||settings.mockResponseAsync||settings.response||settings.responseAsync);},input:function(){return $module.is('input');},loading:function(){return(module.request)?(module.request.state()=='pending'):false;},abortedRequest:function(xhr){if(xhr&&xhr.readyState!==undefined&&xhr.readyState===0){module.verbose('XHR request determined to be aborted');return true;}
        else{module.verbose('XHR request was not aborted');return false;}},validResponse:function(response){if((!module.is.expectingJSON())||!$.isFunction(settings.successTest)){module.verbose('Response is not JSON, skipping validation',settings.successTest,response);return true;}
            module.debug('Checking JSON returned success',settings.successTest,response);if(settings.successTest(response)){module.debug('Response passed success test',response);return true;}
            else{module.debug('Response failed success test',response);return false;}}},was:{cancelled:function(){return(module.cancelled||false);},succesful:function(){return(module.request&&module.request.state()=='resolved');},failure:function(){return(module.request&&module.request.state()=='rejected');},complete:function(){return(module.request&&(module.request.state()=='resolved'||module.request.state()=='rejected'));}},add:{urlData:function(url,urlData){var
            requiredVariables,optionalVariables;if(url){requiredVariables=url.match(settings.regExp.required);optionalVariables=url.match(settings.regExp.optional);urlData=urlData||settings.urlData;if(requiredVariables){module.debug('Looking for required URL variables',requiredVariables);$.each(requiredVariables,function(index,templatedString){var
            variable=(templatedString.indexOf('$')!==-1)?templatedString.substr(2,templatedString.length-3):templatedString.substr(1,templatedString.length-2),value=($.isPlainObject(urlData)&&urlData[variable]!==undefined)?urlData[variable]:($module.data(variable)!==undefined)?$module.data(variable):($context.data(variable)!==undefined)?$context.data(variable):urlData[variable];if(value===undefined){module.error(error.requiredParameter,variable,url);url=false;return false;}
        else{module.verbose('Found required variable',variable,value);value=(settings.encodeParameters)?module.get.urlEncodedValue(value):value;url=url.replace(templatedString,value);}});}
            if(optionalVariables){module.debug('Looking for optional URL variables',requiredVariables);$.each(optionalVariables,function(index,templatedString){var
                variable=(templatedString.indexOf('$')!==-1)?templatedString.substr(3,templatedString.length-4):templatedString.substr(2,templatedString.length-3),value=($.isPlainObject(urlData)&&urlData[variable]!==undefined)?urlData[variable]:($module.data(variable)!==undefined)?$module.data(variable):($context.data(variable)!==undefined)?$context.data(variable):urlData[variable];if(value!==undefined){module.verbose('Optional variable Found',variable,value);url=url.replace(templatedString,value);}
            else{module.verbose('Optional variable not found',variable);if(url.indexOf('/'+templatedString)!==-1){url=url.replace('/'+templatedString,'');}
            else{url=url.replace(templatedString,'');}}});}}
            return url;},formData:function(data){var
            canSerialize=($.fn.serializeObject!==undefined),formData=(canSerialize)?$form.serializeObject():$form.serialize(),hasOtherData;data=data||settings.data;hasOtherData=$.isPlainObject(data);if(hasOtherData){if(canSerialize){module.debug('Extending existing data with form data',data,formData);data=$.extend(true,{},data,formData);}
        else{module.error(error.missingSerialize);module.debug('Cant extend data. Replacing data with form data',data,formData);data=formData;}}
        else{module.debug('Adding form data',formData);data=formData;}
            return data;}},send:{request:function(){module.set.loading();module.request=module.create.request();if(module.is.mocked()){module.mockedXHR=module.create.mockedXHR();}
        else{module.xhr=module.create.xhr();}
            settings.onRequest.call(context,module.request,module.xhr);}},event:{trigger:function(event){module.query();if(event.type=='submit'||event.type=='click'){event.preventDefault();}},xhr:{always:function(){},done:function(response,textStatus,xhr){var
                context=this,elapsedTime=(new Date().getTime()-requestStartTime),timeLeft=(settings.loadingDuration-elapsedTime),translatedResponse=($.isFunction(settings.onResponse))?module.is.expectingJSON()?settings.onResponse.call(context,$.extend(true,{},response)):settings.onResponse.call(context,response):false;timeLeft=(timeLeft>0)?timeLeft:0;if(translatedResponse){module.debug('Modified API response in onResponse callback',settings.onResponse,translatedResponse,response);response=translatedResponse;}
                if(timeLeft>0){module.debug('Response completed early delaying state change by',timeLeft);}
                setTimeout(function(){if(module.is.validResponse(response)){module.request.resolveWith(context,[response,xhr]);}
                else{module.request.rejectWith(context,[xhr,'invalid']);}},timeLeft);},fail:function(xhr,status,httpMessage){var
                context=this,elapsedTime=(new Date().getTime()-requestStartTime),timeLeft=(settings.loadingDuration-elapsedTime);timeLeft=(timeLeft>0)?timeLeft:0;if(timeLeft>0){module.debug('Response completed early delaying state change by',timeLeft);}
                setTimeout(function(){if(module.is.abortedRequest(xhr)){module.request.rejectWith(context,[xhr,'aborted',httpMessage]);}
                else{module.request.rejectWith(context,[xhr,'error',status,httpMessage]);}},timeLeft);}},request:{done:function(response,xhr){module.debug('Successful API Response',response);if(settings.cache==='local'&&url){module.write.cachedResponse(url,response);module.debug('Saving server response locally',module.cache);}
                settings.onSuccess.call(context,response,$module,xhr);},complete:function(firstParameter,secondParameter){var
                xhr,response;if(module.was.succesful()){response=firstParameter;xhr=secondParameter;}
            else{xhr=firstParameter;response=module.get.responseFromXHR(xhr);}
                module.remove.loading();settings.onComplete.call(context,response,$module,xhr);},fail:function(xhr,status,httpMessage){var
                response=module.get.responseFromXHR(xhr),errorMessage=module.get.errorFromRequest(response,status,httpMessage);if(status=='aborted'){module.debug('XHR Aborted (Most likely caused by page navigation or CORS Policy)',status,httpMessage);settings.onAbort.call(context,status,$module,xhr);return true;}
            else if(status=='invalid'){module.debug('JSON did not pass success test. A server-side error has most likely occurred',response);}
            else if(status=='error'){if(xhr!==undefined){module.debug('XHR produced a server error',status,httpMessage);if(xhr.status!=200&&httpMessage!==undefined&&httpMessage!==''){module.error(error.statusMessage+httpMessage,ajaxSettings.url);}
                settings.onError.call(context,errorMessage,$module,xhr);}}
                if(settings.errorDuration&&status!=='aborted'){module.debug('Adding error state');module.set.error();if(module.should.removeError()){setTimeout(module.remove.error,settings.errorDuration);}}
                module.debug('API Request failed',errorMessage,xhr);settings.onFailure.call(context,response,$module,xhr);}}},create:{request:function(){return $.Deferred().always(module.event.request.complete).done(module.event.request.done).fail(module.event.request.fail);},mockedXHR:function(){var
            textStatus=false,status=false,httpMessage=false,responder=settings.mockResponse||settings.response,asyncResponder=settings.mockResponseAsync||settings.responseAsync,asyncCallback,response,mockedXHR;mockedXHR=$.Deferred().always(module.event.xhr.complete).done(module.event.xhr.done).fail(module.event.xhr.fail);if(responder){if($.isFunction(responder)){module.debug('Using specified synchronous callback',responder);response=responder.call(context,requestSettings);}
        else{module.debug('Using settings specified response',responder);response=responder;}
            mockedXHR.resolveWith(context,[response,textStatus,{responseText:response}]);}
        else if($.isFunction(asyncResponder)){asyncCallback=function(response){module.debug('Async callback returned response',response);if(response){mockedXHR.resolveWith(context,[response,textStatus,{responseText:response}]);}
        else{mockedXHR.rejectWith(context,[{responseText:response},status,httpMessage]);}};module.debug('Using specified async response callback',asyncResponder);asyncResponder.call(context,requestSettings,asyncCallback);}
            return mockedXHR;},xhr:function(){var
            xhr;xhr=$.ajax(ajaxSettings).always(module.event.xhr.always).done(module.event.xhr.done).fail(module.event.xhr.fail);module.verbose('Created server request',xhr,ajaxSettings);return xhr;}},set:{error:function(){module.verbose('Adding error state to element',$context);$context.addClass(className.error);},loading:function(){module.verbose('Adding loading state to element',$context);$context.addClass(className.loading);requestStartTime=new Date().getTime();}},remove:{error:function(){module.verbose('Removing error state from element',$context);$context.removeClass(className.error);},loading:function(){module.verbose('Removing loading state from element',$context);$context.removeClass(className.loading);}},get:{responseFromXHR:function(xhr){return $.isPlainObject(xhr)?(module.is.expectingJSON())?module.decode.json(xhr.responseText):xhr.responseText:false;},errorFromRequest:function(response,status,httpMessage){return($.isPlainObject(response)&&response.error!==undefined)?response.error:(settings.error[status]!==undefined)?settings.error[status]:httpMessage;},request:function(){return module.request||false;},xhr:function(){return module.xhr||false;},settings:function(){var
            runSettings;runSettings=settings.beforeSend.call(context,settings);if(runSettings){if(runSettings.success!==undefined){module.debug('Legacy success callback detected',runSettings);module.error(error.legacyParameters,runSettings.success);runSettings.onSuccess=runSettings.success;}
            if(runSettings.failure!==undefined){module.debug('Legacy failure callback detected',runSettings);module.error(error.legacyParameters,runSettings.failure);runSettings.onFailure=runSettings.failure;}
            if(runSettings.complete!==undefined){module.debug('Legacy complete callback detected',runSettings);module.error(error.legacyParameters,runSettings.complete);runSettings.onComplete=runSettings.complete;}}
            if(runSettings===undefined){module.error(error.noReturnedValue);}
            if(runSettings===false){return runSettings;}
            return(runSettings!==undefined)?$.extend(true,{},runSettings):$.extend(true,{},settings);},urlEncodedValue:function(value){var
            decodedValue=window.decodeURIComponent(value),encodedValue=window.encodeURIComponent(value),alreadyEncoded=(decodedValue!==value);if(alreadyEncoded){module.debug('URL value is already encoded, avoiding double encoding',value);return value;}
            module.verbose('Encoding value using encodeURIComponent',value,encodedValue);return encodedValue;},defaultData:function(){var
            data={};if(!$.isWindow(element)){if(module.is.input()){data.value=$module.val();}
        else if(module.is.form()){}
        else{data.text=$module.text();}}
            return data;},event:function(){if($.isWindow(element)||settings.on=='now'){module.debug('API called without element, no events attached');return false;}
        else if(settings.on=='auto'){if($module.is('input')){return(element.oninput!==undefined)?'input':(element.onpropertychange!==undefined)?'propertychange':'keyup';}
        else if($module.is('form')){return'submit';}
        else{return'click';}}
        else{return settings.on;}},templatedURL:function(action){action=action||$module.data(metadata.action)||settings.action||false;url=$module.data(metadata.url)||settings.url||false;if(url){module.debug('Using specified url',url);return url;}
            if(action){module.debug('Looking up url for action',action,settings.api);if(settings.api[action]===undefined&&!module.is.mocked()){module.error(error.missingAction,settings.action,settings.api);return;}
                url=settings.api[action];}
            else if(module.is.form()){url=$module.attr('action')||$context.attr('action')||false;module.debug('No url or action specified, defaulting to form action',url);}
            return url;}},abort:function(){var
        xhr=module.get.xhr();if(xhr&&xhr.state()!=='resolved'){module.debug('Cancelling API request');xhr.abort();}},reset:function(){module.remove.error();module.remove.loading();},setting:function(name,value){module.debug('Changing setting',name,value);if($.isPlainObject(name)){$.extend(true,settings,name);}
    else if(value!==undefined){if($.isPlainObject(settings[name])){$.extend(true,settings[name],value);}
    else{settings[name]=value;}}
    else{return settings[name];}},internal:function(name,value){if($.isPlainObject(name)){$.extend(true,module,name);}
    else if(value!==undefined){module[name]=value;}
    else{return module[name];}},debug:function(){if(!settings.silent&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.debug=Function.prototype.bind.call(console.info,console,settings.name+':');module.debug.apply(console,arguments);}}},verbose:function(){if(!settings.silent&&settings.verbose&&settings.debug){if(settings.performance){module.performance.log(arguments);}
    else{module.verbose=Function.prototype.bind.call(console.info,console,settings.name+':');module.verbose.apply(console,arguments);}}},error:function(){if(!settings.silent){module.error=Function.prototype.bind.call(console.error,console,settings.name+':');module.error.apply(console,arguments);}},performance:{log:function(message){var
            currentTime,executionTime,previousTime;if(settings.performance){currentTime=new Date().getTime();previousTime=time||currentTime;executionTime=currentTime-previousTime;time=currentTime;performance.push({'Name':message[0],'Arguments':[].slice.call(message,1)||'','Execution Time':executionTime});}
            clearTimeout(module.performance.timer);module.performance.timer=setTimeout(module.performance.display,500);},display:function(){var
            title=settings.name+':',totalTime=0;time=false;clearTimeout(module.performance.timer);$.each(performance,function(index,data){totalTime+=data['Execution Time'];});title+=' '+totalTime+'ms';if(moduleSelector){title+=' \''+moduleSelector+'\'';}
            if((console.group!==undefined||console.table!==undefined)&&performance.length>0){console.groupCollapsed(title);if(console.table){console.table(performance);}
            else{$.each(performance,function(index,data){console.log(data['Name']+': '+data['Execution Time']+'ms');});}
                console.groupEnd();}
            performance=[];}},invoke:function(query,passedArguments,context){var
        object=instance,maxDepth,found,response;passedArguments=passedArguments||queryArguments;context=element||context;if(typeof query=='string'&&object!==undefined){query=query.split(/[\. ]/);maxDepth=query.length-1;$.each(query,function(depth,value){var camelCaseValue=(depth!=maxDepth)?value+query[depth+1].charAt(0).toUpperCase()+query[depth+1].slice(1):query;if($.isPlainObject(object[camelCaseValue])&&(depth!=maxDepth)){object=object[camelCaseValue];}
    else if(object[camelCaseValue]!==undefined){found=object[camelCaseValue];return false;}
    else if($.isPlainObject(object[value])&&(depth!=maxDepth)){object=object[value];}
    else if(object[value]!==undefined){found=object[value];return false;}
    else{module.error(error.method,query);return false;}});}
        if($.isFunction(found)){response=found.apply(context,passedArguments);}
        else if(found!==undefined){response=found;}
        if($.isArray(returnedValue)){returnedValue.push(response);}
        else if(returnedValue!==undefined){returnedValue=[returnedValue,response];}
        else if(response!==undefined){returnedValue=response;}
        return found;}};if(methodInvoked){if(instance===undefined){module.initialize();}
    module.invoke(query);}
else{if(instance!==undefined){instance.invoke('destroy');}
    module.initialize();}});return(returnedValue!==undefined)?returnedValue:this;};$.api.settings={name:'API',namespace:'api',debug:false,verbose:false,performance:true,api:{},cache:true,interruptRequests:true,on:'auto',stateContext:false,loadingDuration:0,hideError:'auto',errorDuration:2000,encodeParameters:true,action:false,url:false,base:'',urlData:{},defaultData:true,serializeForm:false,throttle:0,throttleFirstRequest:true,method:'get',data:{},dataType:'json',mockResponse:false,mockResponseAsync:false,response:false,responseAsync:false,beforeSend:function(settings){return settings;},beforeXHR:function(xhr){},onRequest:function(promise,xhr){},onResponse:false,onSuccess:function(response,$module){},onComplete:function(response,$module){},onFailure:function(response,$module){},onError:function(errorMessage,$module){},onAbort:function(errorMessage,$module){},successTest:false,error:{beforeSend:'The before send function has aborted the request',error:'There was an error with your request',exitConditions:'API Request Aborted. Exit conditions met',JSONParse:'JSON could not be parsed during error handling',legacyParameters:'You are using legacy API success callback names',method:'The method you called is not defined',missingAction:'API action used but no url was defined',missingSerialize:'jquery-serialize-object is required to add form data to an existing data object',missingURL:'No URL specified for api event',noReturnedValue:'The beforeSend callback must return a settings object, beforeSend ignored.',noStorage:'Caching responses locally requires session storage',parseError:'There was an error parsing your request',requiredParameter:'Missing a required URL parameter: ',statusMessage:'Server gave an error: ',timeout:'Your request timed out'},regExp:{required:/\{\$*[A-z0-9]+\}/g,optional:/\{\/\$*[A-z0-9]+\}/g,},className:{loading:'loading',error:'error'},selector:{disabled:'.disabled',form:'form'},metadata:{action:'action',url:'url'}};})(jQuery,window,document);
